# gpp secrets

Manage secrets with pluggable backend providers.

## Usage

```bash
gpp secrets <subcommand> [options]
```

## Subcommands

| Subcommand | Description |
|------------|-------------|
| `list` | List all secrets |
| `get <key>` | Get a secret value |
| `set <key> <value>` | Set a secret |
| `delete <key>` | Delete a secret |
| `provider <name>` | Switch secret provider |
| `providers` | List available providers |
| `sync` | Sync secrets to platform .env files |

## List Secrets

```bash
gpp secrets list
```

Lists all secret keys from the current provider (values are masked).

## Get Secret

```bash
gpp secrets get <key>
```

Retrieves and displays a secret value.

### Example

```bash
gpp secrets get DATABASE_URL
```

## Set Secret

```bash
gpp secrets set <key> <value>
```

Sets a secret in the current provider.

### Example

```bash
gpp secrets set DATABASE_URL "postgresql://user:pass@localhost:5432/db"
gpp secrets set API_KEY "sk-abc123..."
```

## Delete Secret

```bash
gpp secrets delete <key>
```

Removes a secret from the current provider.

## Providers

GPP supports multiple secret storage backends:

| Provider | Storage | Writable | Use Case |
|----------|---------|----------|----------|
| `env` | Environment variables | No | CI/CD, containers |
| `dotenv` | `.env.secrets` file | Yes | Local development (default) |
| `file` | JSON file | Yes | Structured storage |
| `vault` | HashiCorp Vault | Yes | Enterprise secrets |
| `aws-sm` | AWS Secrets Manager | Yes | AWS deployments |
| `gcp-sm` | GCP Secret Manager | Yes | GCP deployments |

### List Providers

```bash
gpp secrets providers
```

### Switch Provider

```bash
gpp secrets provider dotenv
gpp secrets provider env
gpp secrets provider file
```

## Sync to Platforms

```bash
gpp secrets sync [options]
```

Copies secrets to platform `.env` files.

### Options

| Option | Description |
|--------|-------------|
| `--only <platforms>` | Only sync to specific platforms |
| `--overwrite` | Overwrite existing values |

### Examples

```bash
# Sync to all platforms
gpp secrets sync

# Sync only to web and api
gpp secrets sync --only web,api

# Overwrite existing values
gpp secrets sync --overwrite
```

## Configuration

### Project Level

Create `.gpp/secrets.json` in your project:

```json
{
  "provider": "dotenv",
  "config": {
    "path": ".env.secrets"
  }
}
```

### Global Level

Create `~/.gpp/secrets.json` for global defaults:

```json
{
  "provider": "dotenv",
  "config": {
    "path": ".env.secrets"
  }
}
```

## Provider Configuration

### dotenv (Default)

Stores secrets in a `.env.secrets` file:

```json
{
  "provider": "dotenv",
  "config": {
    "path": ".env.secrets"
  }
}
```

### file

Stores secrets in a JSON file with metadata:

```json
{
  "provider": "file",
  "config": {
    "path": ".gpp/secrets-store.json"
  }
}
```

### env

Reads from environment variables (read-only):

```json
{
  "provider": "env"
}
```

### vault (Enterprise)

Connects to HashiCorp Vault:

```json
{
  "provider": "vault",
  "config": {
    "address": "https://vault.example.com",
    "token": "${VAULT_TOKEN}",
    "path": "secret/data/myapp"
  }
}
```

### aws-sm

Connects to AWS Secrets Manager:

```json
{
  "provider": "aws-sm",
  "config": {
    "region": "us-east-1",
    "secretId": "myapp/secrets"
  }
}
```

### gcp-sm

Connects to GCP Secret Manager:

```json
{
  "provider": "gcp-sm",
  "config": {
    "project": "my-project",
    "prefix": "myapp_"
  }
}
```

## Security Best Practices

1. **Never commit secrets** - Add `.env.secrets` to `.gitignore`
2. **Use environment provider in CI** - Read from CI environment variables
3. **Rotate secrets regularly** - Update credentials periodically
4. **Use cloud providers in production** - AWS SM, GCP SM, or Vault

## JSON Output

```bash
gpp --json secrets list
gpp --json secrets get API_KEY
```
